<!DOCTYPE html>

<head>
  <title>SafeChat</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/open-iconic/1.1.1/font/css/open-iconic-bootstrap.min.css" integrity="sha256-BJ/G+e+y7bQdrYkS2RBTyNfBHpA9IuGaPmf9htub5MQ=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
    crossorigin="anonymous" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
    crossorigin="anonymous"></script>
  <script src="/socket.io/socket.io.js" crossorigin="anonymous"></script>
  <script src="sodium.js"></script>
  <script src="chat.js"></script>
  <!--<script src="bundle.js"></script>-->
</head>

<body ng-app>
  <div class="container" ng-controller="Chat">

    <!-- Username Modal -->
    <div id="username_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Set Username</h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          </div>
          <div class="modal-body">
            <div class="alert alert-danger" ng-show="username_error">{{username_error}}</div>
            <input id="user_name" class="userinput username" type="text" placeholder="Type a user name here" ng-model="new_username" ng-disabled="join_loading" />
            <input id="chat_pass" class="userinput chatpass" type="text" placeholder="Type the password (if required)" ng-disabled="join_loading" />
          </div>
          <div class="modal-footer">
            <button id="btn-join" class="btn btn-outline-primary" ng-disabled="join_loading" ng-click="setUsername()">
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" ng-show="join_loading"></span> Join</button>
          </div>
        </div>
      </div>
    </div>

    <div class="left-column">
      <button class="btn btn-outline-secondary btn-sm compact-only" ng-click="hideSidebar()">
        <span class="oi oi-chevron-left" title="Hide sidebar" aria-hidden="true"></span>
      </button>
      <img src="safechat.png" class="logo" alt="logo SafeChat" />
      <span id="tot_cnx" class="badge badge-pill badge-dark" title="Total connexions">{{totCnx}}</span>
      <span id="nb_cnx" class="badge badge-pill badge-warning" title="Connexions in this chat">{{nbCnx}}</span>
      <ul class="nav nav-tabs">
        <li ng-repeat="chatter in chatters">
          <a class="color-{{chatter.id % 6}} {{chatter.isMe()}}">{{chatter.name}}</a>
        </li>
      </ul>
      <button class="btn btn-danger" ng-show="my_username" ng-click="clearMessages()">
        <span class="oi oi-trash icon-white" aria-hidden="true"></span> Clear Messages
      </button><br />
      <button class="btn btn-outline-warning" ng-show="my_username && !locked" ng-click="toggleLocked()">
        <span class="oi oi-lock-unlocked" aria-hidden="true" ng-hide="locked"></span>
        <span ng-hide="locked">Lock Chat</span>
      </button>
      <button class="btn btn-warning" ng-show="my_username && locked" ng-click="toggleLocked()">
        <span class="oi oi-lock-locked" aria-hidden="true" ng-show="locked"></span>
        <span ng-show="locked">Unlock Chat</span>
      </button>
      <br />
      <button class="btn btn-outline-dark" ng-show="my_username" ng-click="leaveChat()">
        <span class="oi oi-arrow-left" aria-hidden="true"></span> Leave Chat
      </button><br />
      <a class="hidden" href="#username_modal" ng-show="my_username" data-toggle="modal">
        Change User Name
      </a>
    </div>

    <div class="right-column">
      <div class="title-bar">
        <button class="btn btn-outline-secondary btn-sm compact-only" ng-show="my_username" ng-click="showSidebar()">
          <span class="oi oi-chevron-right" title="Show sidebar" aria-hidden="true"></span>
        </button>
        <h1>{{chat_name}}</h1>
      </div>
      <div class="messages-box" id="messages-box">
        <div class="message row-fluid" ng-hide="messages.length > 0">
          <div class="message-text">
            Securely send this address to anyone you want to chat with: <br />
            <input id="url-txt" type="text" class="form-control form-control-lg" value="{{page_url}}" />
            <button id="btn-copy" class="btn btn-primary btn-block" ng-click="copyUrl()">
              <img src="clippy.png" alt="Copy URL to your clipboard" title="Copy URL" />
            </button>
          </div>
          <div class="message-text">
              I recommend creating a <a href="https://privnote.com" target="_blank">privnote</a> for every one you want to chat with.
          </div>
        </div>
        <div class="message row-fluid color-{{chatters.get(message.sender).id % 6}} {{chatters.get(message.sender).isMe()}} {{message.type}}"
          ng-repeat="message in messages | orderBy: 'time'">
          <strong class="sender span3 {{message.type}}">
            <small class="{{message.type}}">{{message.timeString()}}</small>{{message.sender}}
          </strong>
          <div class="message-text span9 {{message.type}}">{{message.text}}</div>
        </div>
      </div>
      <form class="chat-box" ng-submit="sendMessage()">
        <textarea id="message_textarea" ng-show="my_username" ng-model="message_text"></textarea>
        <input type="submit" value="send" class="btn btn-success" ng-show="my_username" />
        <button data-target="#username_modal" class="btn btn-success btn-lg" ng-hide="locked || my_username" data-toggle="modal">
          Join the conversation
        </button>
      </form>
    </div>

    <!-- Confirm Modal -->
    <div id="confirm_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h3>{{confirm_modal.title}}</h3>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          </div>
          <div class="modal-body">
            {{confirm_modal.message}}
          </div>
          <div class="modal-footer">
            <button href="#" class="btn" ng-click="confirm_modal.respond(false)">No</button>
            <button href="#" class="btn btn-inverse" ng-click="confirm_modal.respond(true)">Yes</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
